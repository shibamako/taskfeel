<p id="notice"><%= notice %></p>

<h1>Tasks</h1>

<div>
<%= link_to t('.new', :default => t("helpers.links.new")),
            new_task_path,
            :class => 'btn btn-primary btn-lg' %>
</div>
<hr>

<div class="card border-primary mb-3" style="max-width:100rem;">
  <div class="card-header">Task検索</div>
  <div class="card-body">

<%= search_form_for @q do |f| %>
<div class="form-group">
  <div class="col-2"><%= f.label :appointed %></div>
  <div class="col-2"><%= f.date_field :appointed_gteq, :class => "form-control" %></div>
  <div class="col-2"><%= f.date_field :appointed_lteq, :class => "form-control" %></div>
</div>
<div class="form-group">
  <div class="col-2"><%= f.label :username %></div>
  <div class="col-2"><%= f.select :username_eq, options_from_collection_for_select(User.where(is_deleted: true), :id, :name), {include_blank: true}, {:class => "form-control"} %></div>
  <div class="col-2"><%= f.label :category %></div>
  <div class="col-2"><%= f.select :category_eq, options_from_collection_for_select(Category.where(mukou: true).order(:serialize), :id, :category_item), {include_blank: true}, {:class => "form-control"} %></div>
  <div class="col-2"><%= f.label :status %></div>
  <div class="col-2"><%= f.select :status_eq, options_from_collection_for_select(Status.where(mukou: true).order(:serialize), :id, :status_item), {include_blank: true}, {:class => "form-control"} %></div>
</div>
<div class="form-group">
  <div class="col-2"><%= f.label :title %></div>
  <div class="col-6"><%= f.text_field :title_cont, :class => "form-control" %></div>
</div>
<br>
<div class="col-2">
  <%= f.submit "検索", class: "form-control btn btn-primary submit_btn" %>
</div>
<% end %>

</div>
</div>

<table class="table table-bordered table-striped table-hover table-condensed">
  <thead>
    <tr>
      <th>詳細</th>
      <th>期日までの日数</th>
      <th><%= sort_link(@q, :appointed, "期日") %></th>
      <th><%= sort_link(@q, :priority, "優先度") %></th>
      <th><%= sort_link(@q, :username, "ユーザー") %></th>
      <th><%= sort_link(@q, :title, "タイトル") %></th>
      <th><%= sort_link(@q, :category, "カテゴリー") %></th>
      <th><%= sort_link(@q, :status, "ステータス") %></th>
      <th colspan="2"></th>
    </tr>
  </thead>

<%= @q.result.count %> / <%= Task.count %> （ヒット件数/全件数）
<%= paginate(@tasks) %>

  <tbody>
    <% @tasks.each do |task| %>
      <tr>
        <td><%= link_to t('.show', :default => t("helpers.links.show")),
                task_path(task), :class => 'btn btn-info btn-xs' %></td>
        <% if task.status == "3" %>
        <td>完了</td>
        <% elsif task.appointed == Date.today %>
        <td>本日</td>
        <% elsif (task.appointed - Date.today).to_i < 0 %>
        <td><font color="red">期限を<%= (Date.today - task.appointed).to_i %>日過ぎています</font></td>
        <% else %>
        <td><%= date_today(task.appointed) %>後</td>
        <% end %>
        <td><%= task.appointed %></td>
        <td><%= Priority.find(task.priority).priority_item %></td>
        <td><%= User.find(task.username).name %></td>
        <td><%= task.title %></td>
        <td><%= Category.find(task.category).category_item %></td>
        <td><%= Status.find(task.status).status_item %></td>
        <td><%= link_to t('.edit', :default => t("helpers.links.edit")),
                      edit_task_path(task), :class => 'btn btn-secondary btn-xs' %></td>
        <td><%= link_to t('.destroy', :default => t("helpers.links.destroy")),
                      task_path(task),
                      :method => :delete,
                      :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                      :class => 'btn btn-xs btn-danger' %></td>
      </tr>
    <% end %>
  </tbody>
</table>
